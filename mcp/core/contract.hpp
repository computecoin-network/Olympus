#pragma once
#include "transaction.hpp"
#include <account/base.hpp>
#include <libdevcore/Address.h>

namespace mcp
{
	const dev::bytes DENContractByteCode(dev::fromHex("0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610fb8806100606000396000f3fe60806040526004361061004a5760003560e01c80631d01364c1461004f5780633ccfd60b1461007a57806388d695b2146100915780638da5cb5b146100ba578063d0e30db0146100e5575b600080fd5b34801561005b57600080fd5b506100646100ef565b6040516100719190610665565b60405180910390f35b34801561008657600080fd5b5061008f6100f5565b005b34801561009d57600080fd5b506100b860048036038101906100b3919061093a565b610261565b005b3480156100c657600080fd5b506100cf61053c565b6040516100dc91906109c1565b60405180910390f35b6100ed610560565b005b60015481565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610183576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161017a90610a5f565b60405180910390fd5b6000479050600060018190555060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16826040516101d790610ab0565b60006040518083038185875af1925050503d8060008114610214576040519150601f19603f3d011682016040523d82523d6000602084013e610219565b606091505b505090508061025d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161025490610b11565b60405180910390fd5b5050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146102ef576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102e690610a5f565b60405180910390fd5b8051825114610333576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161032a90610ba3565b60405180910390fd5b6000805b825181101561037b5782818151811061035357610352610bc3565b5b6020026020010151826103669190610c21565b9150808061037390610c55565b915050610337565b508060015410156103c1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103b890610d0f565b60405180910390fd5b60005b83518110156104e65760008482815181106103e2576103e1610bc3565b5b60200260200101519050600084838151811061040157610400610bc3565b5b6020026020010151905060008273ffffffffffffffffffffffffffffffffffffffff168260405161043190610ab0565b60006040518083038185875af1925050503d806000811461046e576040519150601f19603f3d011682016040523d82523d6000602084013e610473565b606091505b50509050806104b7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104ae90610d7b565b60405180910390fd5b81600160008282546104c99190610d9b565b9250508190555050505080806104de90610c55565b9150506103c4565b503373ffffffffffffffffffffffffffffffffffffffff167ff26e3fc6e983ab510792e764f171fbb7351e426c5da1c3db87569d2ae7349345848460405161052f929190610f4b565b60405180910390a2505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146105ee576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105e590610a5f565b60405180910390fd5b34600160008282546106009190610c21565b925050819055503373ffffffffffffffffffffffffffffffffffffffff167f97f431a6495b8e2dbe7d02105740e05a2178a4c19e315d7573c8ff0ad590e7a460405160405180910390a2565b6000819050919050565b61065f8161064c565b82525050565b600060208201905061067a6000830184610656565b92915050565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6106e282610699565b810181811067ffffffffffffffff82111715610701576107006106aa565b5b80604052505050565b6000610714610680565b905061072082826106d9565b919050565b600067ffffffffffffffff8211156107405761073f6106aa565b5b602082029050602081019050919050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061078182610756565b9050919050565b61079181610776565b811461079c57600080fd5b50565b6000813590506107ae81610788565b92915050565b60006107c76107c284610725565b61070a565b905080838252602082019050602084028301858111156107ea576107e9610751565b5b835b8181101561081357806107ff888261079f565b8452602084019350506020810190506107ec565b5050509392505050565b600082601f83011261083257610831610694565b5b81356108428482602086016107b4565b91505092915050565b600067ffffffffffffffff821115610866576108656106aa565b5b602082029050602081019050919050565b6108808161064c565b811461088b57600080fd5b50565b60008135905061089d81610877565b92915050565b60006108b66108b18461084b565b61070a565b905080838252602082019050602084028301858111156108d9576108d8610751565b5b835b8181101561090257806108ee888261088e565b8452602084019350506020810190506108db565b5050509392505050565b600082601f83011261092157610920610694565b5b81356109318482602086016108a3565b91505092915050565b600080604083850312156109515761095061068a565b5b600083013567ffffffffffffffff81111561096f5761096e61068f565b5b61097b8582860161081d565b925050602083013567ffffffffffffffff81111561099c5761099b61068f565b5b6109a88582860161090c565b9150509250929050565b6109bb81610776565b82525050565b60006020820190506109d660008301846109b2565b92915050565b600082825260208201905092915050565b7f4f6e6c79206f776e65722063616e2063616c6c20746869732066756e6374696f60008201527f6e2e000000000000000000000000000000000000000000000000000000000000602082015250565b6000610a496022836109dc565b9150610a54826109ed565b604082019050919050565b60006020820190508181036000830152610a7881610a3c565b9050919050565b600081905092915050565b50565b6000610a9a600083610a7f565b9150610aa582610a8a565b600082019050919050565b6000610abb82610a8d565b9150819050919050565b7f5769746864726177206661696c65642e00000000000000000000000000000000600082015250565b6000610afb6010836109dc565b9150610b0682610ac5565b602082019050919050565b60006020820190508181036000830152610b2a81610aee565b9050919050565b7f526563697069656e747320616e6420616d6f756e747320617272617973206d7560008201527f73742068617665207468652073616d65206c656e6774682e0000000000000000602082015250565b6000610b8d6038836109dc565b9150610b9882610b31565b604082019050919050565b60006020820190508181036000830152610bbc81610b80565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610c2c8261064c565b9150610c378361064c565b9250828201905080821115610c4f57610c4e610bf2565b5b92915050565b6000610c608261064c565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203610c9257610c91610bf2565b5b600182019050919050565b7f546865206465706f736974656420616d6f756e74206973206e6f7420656e6f7560008201527f676820746f20636f76657220746865207472616e73666572732e000000000000602082015250565b6000610cf9603a836109dc565b9150610d0482610c9d565b604082019050919050565b60006020820190508181036000830152610d2881610cec565b9050919050565b7f5472616e73666572206661696c65642e00000000000000000000000000000000600082015250565b6000610d656010836109dc565b9150610d7082610d2f565b602082019050919050565b60006020820190508181036000830152610d9481610d58565b9050919050565b6000610da68261064c565b9150610db18361064c565b9250828203905081811115610dc957610dc8610bf2565b5b92915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b610e0481610776565b82525050565b6000610e168383610dfb565b60208301905092915050565b6000602082019050919050565b6000610e3a82610dcf565b610e448185610dda565b9350610e4f83610deb565b8060005b83811015610e80578151610e678882610e0a565b9750610e7283610e22565b925050600181019050610e53565b5085935050505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b610ec28161064c565b82525050565b6000610ed48383610eb9565b60208301905092915050565b6000602082019050919050565b6000610ef882610e8d565b610f028185610e98565b9350610f0d83610ea9565b8060005b83811015610f3e578151610f258882610ec8565b9750610f3083610ee0565b925050600181019050610f11565b5085935050505092915050565b60006040820190508181036000830152610f658185610e2f565b90508181036020830152610f798184610eed565b9050939250505056fea2646970667358221220e5e1d734d7eb0b49a48904ab9b0ee025e0667682d8f0438b4b2f1090f36fcdef64736f6c63430008120033"));
	const std::string DENContractABI = "[{\"inputs\": [{\"internalType\": \"address\",\"name\": \"minerAddress\",\"type\": \"address\"}],\"name\": \"isMiner\",\"outputs\": [{\"internalType\": \"bool\",\"name\": \"\",\"type\": \"bool\"}],\"stateMutability\": \"view\",\"type\": \"function\"}]";

	class DENContractCaller
	{
	public:
		DENContractCaller(){}
		DENContractCaller(dev::BoundContract _contract) :contract(_contract) {}

		dev::bytes isMiner(dev::Address minerAddress);
		bool getIsMiner(dev::bytes& data);

		//demo
		// returns int v1, dev::Address v2, std::string v3, bool v4, dev::bytes v5
		template<typename... Args>
		void getreturns(int & v1, dev::h160& v2, std::string& v3, bool& v4, dev::bytes& v5, Args const&... args);
	private:
		dev::BoundContract contract;
	};

	DENContractCaller NewDENContractCaller(dev::ContractCaller const& _caller);
	Transaction InitDenContractTransaction();
	
	/// args: abi input
	/// v1,v2,v3,v4,v5 return values
	template<typename... Args>
	inline void DENContractCaller::getreturns(int & v1, dev::h160& v2, std::string& v3, bool& v4, dev::bytes& v5, Args const&... args)
	{
		std::string method = "getreturns";
		dev::CallOpts opts{ DENManagerAddress };
		dev::bytes ret = contract.Call(&opts, method, args...);
		contract.Unpack(method, ret, v1, v2, v3, v4, v5);
	}

	///ContractCaller instance
	extern DENContractCaller DENCaller;

	///mainnet witness contract
	const dev::bytes MainContractByteCode(dev::fromHex("0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610fb8806100606000396000f3fe60806040526004361061004a5760003560e01c80631d01364c1461004f5780633ccfd60b1461007a57806388d695b2146100915780638da5cb5b146100ba578063d0e30db0146100e5575b600080fd5b34801561005b57600080fd5b506100646100ef565b6040516100719190610665565b60405180910390f35b34801561008657600080fd5b5061008f6100f5565b005b34801561009d57600080fd5b506100b860048036038101906100b3919061093a565b610261565b005b3480156100c657600080fd5b506100cf61053c565b6040516100dc91906109c1565b60405180910390f35b6100ed610560565b005b60015481565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610183576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161017a90610a5f565b60405180910390fd5b6000479050600060018190555060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16826040516101d790610ab0565b60006040518083038185875af1925050503d8060008114610214576040519150601f19603f3d011682016040523d82523d6000602084013e610219565b606091505b505090508061025d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161025490610b11565b60405180910390fd5b5050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146102ef576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102e690610a5f565b60405180910390fd5b8051825114610333576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161032a90610ba3565b60405180910390fd5b6000805b825181101561037b5782818151811061035357610352610bc3565b5b6020026020010151826103669190610c21565b9150808061037390610c55565b915050610337565b508060015410156103c1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103b890610d0f565b60405180910390fd5b60005b83518110156104e65760008482815181106103e2576103e1610bc3565b5b60200260200101519050600084838151811061040157610400610bc3565b5b6020026020010151905060008273ffffffffffffffffffffffffffffffffffffffff168260405161043190610ab0565b60006040518083038185875af1925050503d806000811461046e576040519150601f19603f3d011682016040523d82523d6000602084013e610473565b606091505b50509050806104b7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104ae90610d7b565b60405180910390fd5b81600160008282546104c99190610d9b565b9250508190555050505080806104de90610c55565b9150506103c4565b503373ffffffffffffffffffffffffffffffffffffffff167ff26e3fc6e983ab510792e764f171fbb7351e426c5da1c3db87569d2ae7349345848460405161052f929190610f4b565b60405180910390a2505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146105ee576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105e590610a5f565b60405180910390fd5b34600160008282546106009190610c21565b925050819055503373ffffffffffffffffffffffffffffffffffffffff167f97f431a6495b8e2dbe7d02105740e05a2178a4c19e315d7573c8ff0ad590e7a460405160405180910390a2565b6000819050919050565b61065f8161064c565b82525050565b600060208201905061067a6000830184610656565b92915050565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6106e282610699565b810181811067ffffffffffffffff82111715610701576107006106aa565b5b80604052505050565b6000610714610680565b905061072082826106d9565b919050565b600067ffffffffffffffff8211156107405761073f6106aa565b5b602082029050602081019050919050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061078182610756565b9050919050565b61079181610776565b811461079c57600080fd5b50565b6000813590506107ae81610788565b92915050565b60006107c76107c284610725565b61070a565b905080838252602082019050602084028301858111156107ea576107e9610751565b5b835b8181101561081357806107ff888261079f565b8452602084019350506020810190506107ec565b5050509392505050565b600082601f83011261083257610831610694565b5b81356108428482602086016107b4565b91505092915050565b600067ffffffffffffffff821115610866576108656106aa565b5b602082029050602081019050919050565b6108808161064c565b811461088b57600080fd5b50565b60008135905061089d81610877565b92915050565b60006108b66108b18461084b565b61070a565b905080838252602082019050602084028301858111156108d9576108d8610751565b5b835b8181101561090257806108ee888261088e565b8452602084019350506020810190506108db565b5050509392505050565b600082601f83011261092157610920610694565b5b81356109318482602086016108a3565b91505092915050565b600080604083850312156109515761095061068a565b5b600083013567ffffffffffffffff81111561096f5761096e61068f565b5b61097b8582860161081d565b925050602083013567ffffffffffffffff81111561099c5761099b61068f565b5b6109a88582860161090c565b9150509250929050565b6109bb81610776565b82525050565b60006020820190506109d660008301846109b2565b92915050565b600082825260208201905092915050565b7f4f6e6c79206f776e65722063616e2063616c6c20746869732066756e6374696f60008201527f6e2e000000000000000000000000000000000000000000000000000000000000602082015250565b6000610a496022836109dc565b9150610a54826109ed565b604082019050919050565b60006020820190508181036000830152610a7881610a3c565b9050919050565b600081905092915050565b50565b6000610a9a600083610a7f565b9150610aa582610a8a565b600082019050919050565b6000610abb82610a8d565b9150819050919050565b7f5769746864726177206661696c65642e00000000000000000000000000000000600082015250565b6000610afb6010836109dc565b9150610b0682610ac5565b602082019050919050565b60006020820190508181036000830152610b2a81610aee565b9050919050565b7f526563697069656e747320616e6420616d6f756e747320617272617973206d7560008201527f73742068617665207468652073616d65206c656e6774682e0000000000000000602082015250565b6000610b8d6038836109dc565b9150610b9882610b31565b604082019050919050565b60006020820190508181036000830152610bbc81610b80565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610c2c8261064c565b9150610c378361064c565b9250828201905080821115610c4f57610c4e610bf2565b5b92915050565b6000610c608261064c565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203610c9257610c91610bf2565b5b600182019050919050565b7f546865206465706f736974656420616d6f756e74206973206e6f7420656e6f7560008201527f676820746f20636f76657220746865207472616e73666572732e000000000000602082015250565b6000610cf9603a836109dc565b9150610d0482610c9d565b604082019050919050565b60006020820190508181036000830152610d2881610cec565b9050919050565b7f5472616e73666572206661696c65642e00000000000000000000000000000000600082015250565b6000610d656010836109dc565b9150610d7082610d2f565b602082019050919050565b60006020820190508181036000830152610d9481610d58565b9050919050565b6000610da68261064c565b9150610db18361064c565b9250828203905081811115610dc957610dc8610bf2565b5b92915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b610e0481610776565b82525050565b6000610e168383610dfb565b60208301905092915050565b6000602082019050919050565b6000610e3a82610dcf565b610e448185610dda565b9350610e4f83610deb565b8060005b83811015610e80578151610e678882610e0a565b9750610e7283610e22565b925050600181019050610e53565b5085935050505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b610ec28161064c565b82525050565b6000610ed48383610eb9565b60208301905092915050565b6000602082019050919050565b6000610ef882610e8d565b610f028185610e98565b9350610f0d83610ea9565b8060005b83811015610f3e578151610f258882610ec8565b9750610f3083610ee0565b925050600181019050610f11565b5085935050505092915050565b60006040820190508181036000830152610f658185610e2f565b90508181036020830152610f798184610eed565b9050939250505056fea2646970667358221220e5e1d734d7eb0b49a48904ab9b0ee025e0667682d8f0438b4b2f1090f36fcdef64736f6c63430008120033"));
	const std::string MainContractABI = "[{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"recipients\",\"type\":\"address[]\"},{\"internalType\":\"uint256[]\",\"name\":\"amounts\",\"type\":\"uint256[]\"}],\"name\":\"batchTransfer\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]";
	const dev::Address MainContractAddress = dev::Address("0xD2b53c6dcF4EB754DE108ec0420EE7EcfC1223B3");
	const dev::Address MainCallcAddress = dev::Address("0x1144b522f45265c2dfdbaee8e324719e63a1694c");
	Transaction InitMainContractTransaction();

	class MainContractCaller
	{
	public:
		MainContractCaller() {}
		MainContractCaller(dev::BoundContract _contract) :contract(_contract) {}

		dev::bytes BatchTransfer(std::map<dev::Address, u256> const& _v);
	private:
		dev::CallOpts DefaultOpts{ MainCallcAddress };
		dev::BoundContract contract;
	};

	MainContractCaller NewMainContractCaller(dev::ContractCaller const& _caller);
	///ContractCaller instance
	extern MainContractCaller MainCaller;
}
